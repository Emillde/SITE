// Language translation dictionary
const translations = {
  it: {
    // Navigation
    nav_home: "Home",
    nav_chi_siamo: "Chi siamo",
    nav_servizi: "Servizi",
    nav_social: "Social",
    nav_contatti: "Contatti",
    
    // Homepage
    hero_title: "Argjend Barber Shop",
    hero_subtitle: "Rasature, cura della barba e tagli moderni, piega, colore e servizi professionali per donna.",
    cta_call: "Chiama ora",
    cta_directions: "Come arrivare",
    scroll_discover: "Scorri per scoprire",
    quick_nav_title: "Navigazione Rapida",
    quick_nav_who: "Chi siamo",
    quick_nav_who_desc: "Scopri la nostra storia e la passione per il barbering",
    quick_nav_services: "Servizi",
    quick_nav_services_desc: "Tagli, rasature e trattamenti per uomo",
    quick_nav_social: "Social",
    quick_nav_social_desc: "Guarda i nostri lavori su Instagram",
    
    // Chi Siamo
    chi_siamo_title: "Chi siamo",
    chi_siamo_desc: "Barberia per uomo a Trieste. Qualità, cura dei dettagli e stile senza tempo dal 2012. Tradizione, accoglienza e mani esperte con radici autentiche che portano carattere e stile.",
    reviews_title: "Recensioni",
    
    // Servizi
    servizi_title: "Servizi",
    servizi_desc: "Listino indicativo. Per informazioni aggiornate chiamaci.",
    servizi_donna: "Donna",
    servizi_uomo: "Uomo",
    servizi_capelli: "Capelli",
    servizi_manipiedi: "Mani & Piedi",
    servizi_capellibarba: "Capelli & Barba",
    
    // Contatti
    contatti_title: "Contattaci",
    contatti_desc: "Per appuntamenti e informazioni chiamaci o scrivici. Siamo aperti tutta la settimana tranne lunedì 10:00–20:00.",
    dove_siamo: "Dove Siamo",
    indirizzo: "Indirizzo",
    telefono: "Telefono",
    orari_apertura: "Orari di apertura",
    naviga_maps: "Naviga con Google Maps",
    invia_messaggio: "Invia un messaggio",
    nome: "Nome",
    email: "Email",
    messaggio: "Messaggio",
    invia: "Invia",
    
    // Social
    social_title: "Social",
    social_desc: "Scopri foto reali del salone e dei nostri lavori.",
    dal_nostro_profilo: "Dal nostro profilo",
    
    // Footer
    copyright: "© <span id=\"year\"></span> Argjend Barber Shop — Tutti i diritti riservati. <a href=\"contact.html\" class=\"footer-link\">Made by Emil de Cristini</a>",
    
    // Cookie consent
    cookie_text: "Questo sito utilizza i cookie per migliorare la tua esperienza. <a href=\"/privacy.html\">Leggi la nostra policy.</a>",
    cookie_accept: "Accetta",
    cookie_decline: "Rifiuta",
    
    // Form placeholders
    name_placeholder: "Il tuo nome",
    email_placeholder: "nome@email.it",
    message_placeholder: "Come possiamo aiutarti?",
    
    // Language switcher
    language_switch: "Lingua"
  },
  
  en: {
    // Navigation
    nav_home: "Home",
    nav_chi_siamo: "About Us",
    nav_servizi: "Services",
    nav_social: "Social",
    nav_contatti: "Contacts",
    
    // Homepage
    hero_title: "Argjend Barber Shop",
    hero_subtitle: "Shaves, beard care and modern cuts, styling, coloring and professional services for women.",
    cta_call: "Call Now",
    cta_directions: "Get Directions",
    scroll_discover: "Scroll to discover",
    quick_nav_title: "Quick Navigation",
    quick_nav_who: "About Us",
    quick_nav_who_desc: "Discover our story and passion for barbering",
    quick_nav_services: "Services",
    quick_nav_services_desc: "Cuts, shaves and treatments for men",
    quick_nav_social: "Social",
    quick_nav_social_desc: "See our work on Instagram",
    
    // Chi Siamo
    chi_siamo_title: "About Us",
    chi_siamo_desc: "Men's barbershop in Trieste. Quality, attention to detail and timeless style since 2012. Tradition, hospitality and expert hands with authentic roots that bring character and style.",
    reviews_title: "Reviews",
    
    // Servizi
    servizi_title: "Services",
    servizi_desc: "Indicative price list. Call for updated information.",
    servizi_donna: "Women",
    servizi_uomo: "Men",
    servizi_capelli: "Hair",
    servizi_manipiedi: "Hands & Feet",
    servizi_capellibarba: "Hair & Beard",
    
    // Contatti
    contatti_title: "Contact Us",
    contatti_desc: "For appointments and information call or write to us. Open all week except Monday 10:00–20:00.",
    dove_siamo: "Where We Are",
    indirizzo: "Address",
    telefono: "Phone",
    orari_apertura: "Opening Hours",
    naviga_maps: "Navigate with Google Maps",
    invia_messaggio: "Send a Message",
    nome: "Name",
    email: "Email",
    messaggio: "Message",
    invia: "Send",
    
    // Social
    social_title: "Social",
    social_desc: "Discover real photos of the salon and our work.",
    dal_nostro_profilo: "From Our Profile",
    
    // Footer
    copyright: "© <span id=\"year\"></span> Argjend Barber Shop — All rights reserved. <a href=\"contact.html\" class=\"footer-link\">Made by Emil de Cristini</a>",
    
    // Cookie consent
    cookie_text: "This site uses cookies to improve your experience. <a href=\"/privacy.html\">Read our policy.</a>",
    cookie_accept: "Accept",
    cookie_decline: "Decline",
    
    // Form placeholders
    name_placeholder: "Your name",
    email_placeholder: "name@email.com",
    message_placeholder: "How can we help you?",
    
    // Language switcher
    language_switch: "Language"
  },
  
  sq: {
    // Navigation
    nav_home: "Shtëpia",
    nav_chi_siamo: "Rreth Nesh",
    nav_servizi: "Shërbimet",
    nav_social: "Social",
    nav_contatti: "Kontaktet",
    
    // Homepage
    hero_title: "Argjend Barber Shop",
    hero_subtitle: "Rrëshqitje, kujdes i mjekrave dhe prerje moderne, stilim, ngjyrosje dhe shërbime profesionale për gra.",
    cta_call: "Thirr Tani",
    cta_directions: "Si të Arrish",
    scroll_discover: "Rrëshqit për të zbuluar",
    quick_nav_title: "Lundrim i Shpejtë",
    quick_nav_who: "Rreth Nesh",
    quick_nav_who_desc: "Zbulo historinë tonë dhe pasionin për barbering",
    quick_nav_services: "Shërbimet",
    quick_nav_services_desc: "Prerje, rrëshqitje dhe trajtime për burra",
    quick_nav_social: "Social",
    quick_nav_social_desc: "Shiko punën tonë në Instagram",
    
    // Chi Siamo
    chi_siamo_title: "Rreth Nesh",
    chi_siamo_desc: "Barber për burra në Trieste. Cilësi, vëmendje ndaj detajeve dhe stil pa kohë që nga viti 2012. Traditë, mikpritje dhe duar eksperte me rrënjë autentike që sjellin karakter dhe stil.",
    reviews_title: "Recensione",
    
    // Servizi
    servizi_title: "Shërbimet",
    servizi_desc: "Listë çmimesh indikative. Thirrni për informata të përditësuara.",
    servizi_donna: "Gra",
    servizi_uomo: "Burra",
    servizi_capelli: "Flokt",
    servizi_manipiedi: "Duart & Këmbët",
    servizi_capellibarba: "Flokt & Mjekra",
    
    // Contatti
    contatti_title: "Kontaktoni",
    contatti_desc: "Për takime dhe informata thirrni ose shkruani ne. Hapur të gjithë javën përveç hënës 10:00–20:00.",
    dove_siamo: "Ku Gjendemi",
    indirizzo: "Adresa",
    telefono: "Telefoni",
    orari_apertura: "Oraret e Hapjes",
    naviga_maps: "Lundrim me Google Maps",
    invia_messaggio: "Dërgo Mesazh",
    nome: "Emri",
    email: "Email",
    messaggio: "Mesazh",
    invia: "Dërgo",
    
    // Social
    social_title: "Social",
    social_desc: "Zbulo foto reale të salonit dhe punës sonë.",
    dal_nostro_profilo: "Nga Profili Ynë",
    
    // Footer
    copyright: "© <span id=\"year\"></span> Argjend Barber Shop — Të gjitha të drejtat e rezervuara. <a href=\"contact.html\" class=\"footer-link\">Made by Emil de Cristini</a>",
    
    // Cookie consent
    cookie_text: "Kjo faqe përdor cookies për të përmirësuar përvojën tuaj. <a href=\"/privacy.html\">Lexo politikën tonë.</a>",
    cookie_accept: "Prano",
    cookie_decline: "Refuzo",
    
    // Form placeholders
    name_placeholder: "Emri juaj",
    email_placeholder: "emri@email.com",
    message_placeholder: "Si mund t'ju ndihmojmë?",
    
    // Language switcher
    language_switch: "Gjuha"
  }
};

// Language switcher functionality
class LanguageSwitcher {
  constructor() {
    this.currentLang = localStorage.getItem('selectedLanguage') || 'it';
    this.init();
  }

  init() {
    this.createLanguageSwitcher();
    this.applyTranslations(this.currentLang);
    this.bindEvents();
    this.initScrollBehavior();
  }

  createLanguageSwitcher() {
    const switcherHTML = `
      <div class="language-switcher" id="languageSwitcher">
        <button class="language-btn" data-lang="it">IT</button>
        <button class="language-btn" data-lang="en">EN</button>
        <button class="language-btn" data-lang="sq">SQ</button>
      </div>
    `;
    
    // Insert language switcher at the beginning of body (fixed position)
    document.body.insertAdjacentHTML('afterbegin', switcherHTML);
    
    // Set active language button
    this.updateActiveButton();
  }

  bindEvents() {
    document.addEventListener('click', (e) => {
      if (e.target.classList.contains('language-btn')) {
        const lang = e.target.dataset.lang;
        this.switchLanguage(lang);
      }
    });
  }

  switchLanguage(lang) {
    if (lang === this.currentLang) return;
    
    // Create full-screen overlay
    const overlay = document.createElement('div');
    overlay.className = 'language-transition-overlay';
    overlay.innerHTML = `
      <div class="language-transition-content">
        ${lang.toUpperCase()}
      </div>
    `;
    document.body.appendChild(overlay);
    
    // Show overlay immediately
    requestAnimationFrame(() => {
      overlay.classList.add('active');
    });
    
    // Change language quickly
    setTimeout(() => {
      this.currentLang = lang;
      localStorage.setItem('selectedLanguage', lang);
      this.applyTranslations(lang);
      this.updateActiveButton();
      
      // Update HTML lang attribute
      document.documentElement.lang = lang === 'sq' ? 'sq' : lang;
    }, 300);
    
    // Hide overlay and remove
    setTimeout(() => {
      overlay.classList.remove('active');
      setTimeout(() => {
        document.body.removeChild(overlay);
      }, 300);
    }, 800);
  }

  initScrollBehavior() {
    let lastScrollY = window.scrollY;
    let scrollTimer = null;
    const switcher = document.getElementById('languageSwitcher');
    
    if (!switcher) return;
    
    const handleScroll = () => {
      const currentScrollY = window.scrollY;
      const isMobile = window.innerWidth <= 768;
      
      // Show/hide logic
      if (currentScrollY > 150 && currentScrollY > lastScrollY) {
        // Scrolling down past 150px - hide
        switcher.style.transform = `translateY(${isMobile ? '-120px' : '-100px'})`;
        switcher.style.opacity = '0';
        switcher.style.pointerEvents = 'none';
      } else {
        // At top or scrolling up - show
        switcher.style.transform = 'translateY(0)';
        switcher.style.opacity = '1';
        switcher.style.pointerEvents = 'auto';
      }
      
      lastScrollY = currentScrollY;
    };
    
    // Optimized scroll handler with throttling
    let ticking = false;
    const throttledHandleScroll = () => {
      if (!ticking) {
        requestAnimationFrame(() => {
          handleScroll();
          ticking = false;
        });
        ticking = true;
      }
    };
    
    // Add scroll listener
    window.addEventListener('scroll', throttledHandleScroll, { passive: true });
    
    // Handle resize for mobile/desktop changes
    window.addEventListener('resize', () => {
      clearTimeout(scrollTimer);
      scrollTimer = setTimeout(() => {
        lastScrollY = window.scrollY; // Reset on resize
        handleScroll(); // Re-evaluate position
      }, 150);
    });
  }

  updateActiveButton() {
    document.querySelectorAll('.language-btn').forEach(btn => {
      btn.classList.toggle('active', btn.dataset.lang === this.currentLang);
    });
  }

  applyTranslations(lang) {
    const trans = translations[lang];
    
    // Update all elements with data-translate attribute
    document.querySelectorAll('[data-translate]').forEach(element => {
      const key = element.dataset.translate;
      if (trans[key]) {
        if (element.tagName === 'INPUT' || element.tagName === 'TEXTAREA') {
          element.placeholder = trans[key];
        } else {
          element.innerHTML = trans[key];
        }
      }
    });
    
    // Update navigation links
    this.updateNavigation(trans);
    
    // Update page title
    this.updatePageTitle(trans);
    
    // Update meta description if needed
    this.updateMetaDescription(trans);
  }

  updateNavigation(trans) {
    const navLinks = {
      'index.html': trans.nav_home,
      'chi-siamo.html': trans.nav_chi_siamo,
      'servizi.html': trans.nav_servizi,
      'social.html': trans.nav_social,
      'contatti.html': trans.nav_contatti
    };
    
    Object.keys(navLinks).forEach(href => {
      const link = document.querySelector(`.site-nav a[href="${href}"]`);
      if (link) {
        link.textContent = navLinks[href];
      }
      
      // Also update mobile menu
      const mobileLink = document.querySelector(`.mobile-menu-nav a[href="${href}"]`);
      if (mobileLink) {
        mobileLink.textContent = navLinks[href];
      }
    });
  }

  updatePageTitle(trans) {
    const currentPath = window.location.pathname;
    const pageName = currentPath.split('/').pop().replace('.html', '');
    
    const titles = {
      'index': trans.hero_title,
      'chi-siamo': trans.chi_siamo_title,
      'servizi': trans.servizi_title,
      'contatti': trans.contatti_title,
      'social': trans.social_title
    };
    
    if (titles[pageName]) {
      document.title = `${titles[pageName]} — Argjend Barber Shop Trieste`;
    }
  }

  updateMetaDescription(trans) {
    const metaDesc = document.querySelector('meta[name="description"]');
    if (metaDesc) {
      const currentPath = window.location.pathname;
      const pageName = currentPath.split('/').pop().replace('.html', '');
      
      const descriptions = {
        'index': `${trans.hero_subtitle} Chiama: +39 380 283 5412.`,
        'chi-siamo': `${trans.chi_siamo_desc} Chiama: +39 380 283 5412.`,
        'servizi': `${trans.servizi_desc} Chiama: +39 380 283 5412.`,
        'contatti': `${trans.contatti_desc}`,
        'social': `${trans.social_desc} @barber_shop_argjend1.`
      };
      
      if (descriptions[pageName]) {
        metaDesc.content = descriptions[pageName];
      }
    }
  }
}

// Initialize language switcher when DOM is ready
document.addEventListener('DOMContentLoaded', () => {
  new LanguageSwitcher();
});

// Export for potential use in other scripts
window.LanguageSwitcher = LanguageSwitcher;
